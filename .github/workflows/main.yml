name: 'Update schedule'

on:
  schedule:
    - cron: '0 22,10 * * *'  # UTC时间每天22:00和10:00执行（对应北京时间6:00和18:00）
  workflow_dispatch:          # 允许手动触发

jobs:
  push:
    runs-on: ubuntu-latest
    steps:
      # 设置分支名称（根据您的仓库改为master）
      - name: Set branch name
        run: echo "BRANCH_NAME=master" >> $GITHUB_ENV

      # 检出代码（使用您配置的PAT密钥）
      - uses: actions/checkout@v3
        with:
          ref: ${{ env.BRANCH_NAME }}
          token: ${{ secrets.PAT }}  # 使用您已配置的PAT密钥

      # 设置Python环境
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      # 安装依赖
      - name: Install dependencies
        run: pip install -r requirements.txt

      # 运行更新脚本
      - name: Run update
        run: python main.py

      # 配置Git并提交更改
      - name: Commit and push
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add .
          if ! git diff --staged --quiet; then
            git commit -m "Auto Update: $(date +'%Y-%m-%d %H:%M')"
            git push
          fi